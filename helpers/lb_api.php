<?php
 goto Hd5aW; y8Ji5: define("\x4c\x42\137\x54\x45\130\x54\137\125\120\x44\101\124\x45\137\127\x49\x54\x48\x5f\123\x51\x4c\137\111\x4d\x50\x4f\x52\x54\x5f\106\101\x49\114\x45\x44", "\x41\x70\160\x6c\151\x63\x61\164\x69\x6f\156\x20\x77\x61\163\x20\163\x75\143\143\145\x73\x73\x66\x75\x6c\x6c\171\40\x75\x70\x64\x61\x74\x65\x64\40\x62\x75\x74\40\x61\x75\x74\x6f\x6d\141\164\151\x63\40\123\x51\114\x20\151\x6d\x70\x6f\x72\x74\151\x6e\147\x20\x66\141\151\x6c\x65\144\x2c\x20\x70\154\145\141\163\x65\40\x69\155\x70\157\x72\164\x20\x74\x68\145\40\x64\x6f\167\156\154\157\x61\144\145\x64\x20\123\121\114\x20\x66\x69\154\x65\x20\x69\x6e\x20\171\x6f\x75\x72\40\x64\141\x74\141\x62\x61\163\x65\x20\155\x61\x6e\165\x61\154\x6c\171\x2e"); goto WSxxY; qNK77: define("\114\x42\x5f\124\x45\130\x54\x5f\x44\x4f\116\x54\137\122\x45\x46\x52\105\x53\x48", "\x28\120\154\145\x61\x73\145\40\x64\157\x20\x6e\x6f\164\40\x72\x65\146\162\x65\163\150\x20\164\x68\x65\40\x70\141\147\145\x29\56"); goto zVCjg; q0Io8: define("\114\102\x5f\x54\x45\x58\x54\x5f\125\120\104\x41\124\x45\137\127\x49\x54\x48\117\x55\x54\137\123\121\114\x5f\x44\117\116\x45", "\101\160\160\x6c\x69\x63\141\164\x69\x6f\156\x20\x77\x61\163\x20\x73\165\143\x63\145\x73\x73\x66\x75\154\x6c\x79\x20\165\160\144\x61\164\x65\144\x2c\x20\x74\x68\145\162\x65\40\167\145\162\x65\x20\156\157\40\123\x51\x4c\40\165\160\144\x61\x74\145\x73\x2e"); goto W3n1F; tZijW: define("\114\x42\137\x54\105\130\x54\137\x43\117\x4e\x4e\105\x43\124\111\117\116\137\x46\101\x49\114\105\x44", "\x53\x65\162\166\145\162\40\151\x73\40\x75\x6e\141\x76\x61\151\x6c\141\x62\x6c\145\x20\141\x74\40\x74\x68\x65\x20\x6d\x6f\155\x65\x6e\x74\54\x20\x70\x6c\145\x61\x73\145\40\164\162\x79\x20\x61\x67\141\151\156\56"); goto SAhf1; l4lQG: define("\114\102\137\x54\105\x58\x54\x5f\x55\x50\104\101\x54\x45\x5f\105\x58\x54\122\x41\x43\x54\x49\x4f\x4e\137\105\x52\x52\x4f\x52", "\x55\x70\144\x61\x74\x65\x20\172\x69\160\x20\145\x78\x74\x72\141\x63\164\151\x6f\156\40\146\x61\151\x6c\145\144\x2e"); goto yfZTn; Eg8x_: define("\114\x42\137\124\x45\130\124\x5f\x53\121\114\x5f\x55\120\104\101\124\x45\x5f\123\111\x5a\x45", "\123\121\x4c\x20\125\160\x64\141\164\x65\x20\x73\151\x7a\145\72"); goto BVF3y; ACaQj: define("\114\102\137\x54\x45\x58\124\x5f\115\x41\x49\x4e\x5f\x55\x50\x44\x41\x54\105\137\x53\111\132\x45", "\115\x61\151\156\40\x55\160\x64\x61\x74\145\40\x73\151\172\145\x3a"); goto qNK77; YM7DE: define("\x4c\102\137\x54\105\x58\x54\137\126\x45\122\x49\x46\x49\x45\x44\x5f\x52\105\123\x50\117\x4e\123\105", "\x56\x65\162\151\146\x69\145\144\x21\x20\x54\150\x61\156\153\x73\x20\x66\x6f\162\40\x70\x75\162\143\150\x61\163\x69\x6e\147\56"); goto cV8hm; BVF3y: define("\114\x42\137\124\x45\x58\x54\137\104\117\127\x4e\114\x4f\101\104\x49\116\107\137\x53\x51\x4c", "\104\x6f\167\156\x6c\x6f\141\x64\151\156\147\x20\123\x51\114\40\x75\x70\x64\x61\x74\145\56\56\56"); goto rPbTh; Hd5aW: if (count(get_included_files()) == 1) { die("\116\x6f\x20\144\x69\162\x65\x63\164\x20\x73\143\x72\151\x70\x74\x20\141\x63\x63\x65\163\163\x20\x61\154\x6c\157\x77\145\x64"); } goto nTHHh; fEZoe: define("\114\x42\x5f\123\110\x4f\127\137\125\x50\x44\101\124\105\x5f\120\122\x4f\107\x52\105\123\x53", true); goto tZijW; BxIX1: if (@ini_get("\x6d\141\x78\x5f\x65\170\145\x63\165\164\151\157\156\x5f\164\151\x6d\145") !== "\x30" && @ini_get("\155\x61\170\x5f\x65\x78\x65\x63\165\x74\x69\157\x6e\137\x74\151\x6d\x65") < 600) { @ini_set("\155\141\170\x5f\145\x78\x65\143\x75\x74\151\157\156\x5f\x74\x69\155\x65", 600); } goto orBkt; cV8hm: define("\114\x42\137\124\105\130\x54\137\x50\122\105\120\101\x52\x49\x4e\107\x5f\115\x41\x49\116\x5f\104\x4f\127\116\114\117\x41\104", "\120\x72\x65\160\x61\x72\x69\156\x67\40\164\x6f\40\x64\x6f\167\x6e\x6c\x6f\141\144\x20\155\x61\x69\156\x20\x75\x70\x64\141\164\145\x2e\56\x2e"); goto ACaQj; R7JUr: define("\x4c\x42\137\x54\x45\x58\124\x5f\x55\120\x44\x41\x54\x45\x5f\x50\105\x52\x49\x4f\x44\x5f\105\130\120\111\122\x45\x44", "\131\x6f\165\162\x20\x75\160\144\x61\164\x65\x20\x70\x65\162\x69\157\144\x20\x68\x61\x73\x20\x65\156\x64\x65\x64\40\x6f\x72\x20\171\157\x75\162\x20\154\x69\143\145\156\x73\x65\x20\151\x73\40\x69\156\x76\141\154\151\x64\x2c\40\x70\154\145\141\163\x65\x20\143\157\156\x74\141\143\164\40\163\x75\160\160\x6f\162\164\56"); goto o4FAZ; Qni9u: define("\114\102\x5f\124\x45\x58\x54\x5f\x4d\x41\x49\x4e\137\x55\120\104\101\x54\105\137\x44\x4f\116\x45", "\x4d\141\151\156\40\x75\160\x64\x61\164\x65\x20\x66\x69\x6c\145\163\x20\x64\x6f\x77\156\x6c\x6f\141\x64\x65\x64\40\141\156\x64\x20\145\x78\164\162\141\143\x74\x65\144\56"); goto l4lQG; rPbTh: define("\x4c\102\137\x54\x45\x58\124\137\123\x51\114\137\x55\x50\x44\101\124\105\x5f\104\117\x4e\105", "\x53\121\114\40\165\x70\x64\x61\164\145\x20\x66\151\154\x65\x73\40\144\157\x77\x6e\154\x6f\x61\x64\145\x64\x2e"); goto y8Ji5; WSxxY: define("\x4c\x42\137\x54\105\x58\x54\x5f\125\x50\104\101\x54\x45\x5f\127\x49\x54\x48\137\x53\121\114\137\x49\115\120\x4f\x52\x54\x5f\104\117\116\105", "\101\x70\160\x6c\x69\x63\141\164\x69\157\x6e\40\x77\x61\x73\40\x73\x75\x63\x63\145\x73\163\x66\165\154\x6c\171\x20\165\160\144\141\164\x65\x64\x20\x61\156\144\40\x53\x51\x4c\40\x66\151\154\145\40\167\141\x73\40\x61\165\164\157\x6d\x61\x74\151\x63\141\x6c\x6c\171\40\x69\x6d\x70\157\162\x74\x65\x64\56"); goto mocMt; nTHHh: define("\x4c\102\137\x41\x50\111\137\104\x45\102\x55\107", false); goto fEZoe; W3n1F: if (!LB_API_DEBUG) { @ini_set("\x64\x69\x73\x70\x6c\141\x79\x5f\145\162\x72\157\x72\x73", 0); } goto BxIX1; zVCjg: define("\x4c\102\137\124\x45\130\x54\137\x44\x4f\127\116\x4c\x4f\x41\x44\x49\116\107\x5f\x4d\101\x49\116", "\104\x6f\x77\156\x6c\157\x61\144\151\156\x67\x20\155\141\x69\156\40\165\160\x64\x61\x74\145\56\x2e\x2e"); goto R7JUr; yfZTn: define("\114\102\x5f\124\105\x58\124\137\x50\122\x45\120\101\122\111\x4e\107\137\123\x51\114\137\x44\117\x57\x4e\114\x4f\101\x44", "\x50\x72\145\x70\141\162\x69\156\147\x20\x74\x6f\x20\144\157\167\156\154\157\x61\144\40\x53\121\x4c\x20\x75\160\144\x61\x74\x65\56\x2e\56"); goto Eg8x_; orBkt: @ini_set("\155\x65\x6d\157\x72\171\137\x6c\x69\x6d\x69\164", "\x32\x35\66\115"); goto joBRR; SAhf1: define("\114\102\x5f\124\x45\130\x54\137\111\x4e\126\x41\x4c\111\104\137\x52\x45\123\x50\x4f\x4e\x53\x45", "\123\x65\x72\166\145\162\x20\162\145\164\165\x72\156\145\x64\x20\141\x6e\40\151\x6e\x76\x61\x6c\x69\x64\40\162\x65\x73\160\x6f\x6e\x73\145\x2c\x20\160\154\x65\x61\163\145\40\143\x6f\x6e\164\x61\143\x74\40\163\165\160\160\x6f\162\164\x2e"); goto YM7DE; mocMt: define("\x4c\102\137\x54\105\x58\x54\137\125\x50\x44\101\x54\105\137\127\x49\124\x48\x5f\x53\121\x4c\x5f\104\117\x4e\105", "\101\160\160\154\x69\143\x61\164\x69\157\x6e\40\167\141\x73\x20\163\165\143\143\x65\163\163\146\x75\154\x6c\171\x20\165\x70\x64\x61\x74\145\x64\x2c\x20\x70\x6c\x65\x61\163\x65\40\151\155\x70\157\x72\x74\40\164\x68\145\x20\x64\x6f\167\156\x6c\157\x61\x64\145\x64\40\123\x51\114\40\146\x69\x6c\145\40\151\156\40\x79\x6f\165\162\40\144\x61\x74\141\x62\x61\163\145\40\x6d\141\156\x75\x61\x6c\154\171\x2e"); goto q0Io8; o4FAZ: define("\114\102\x5f\x54\105\x58\124\x5f\x55\x50\x44\x41\x54\105\137\120\x41\x54\110\137\x45\x52\x52\x4f\x52", "\106\x6f\154\144\145\x72\x20\x64\x6f\x65\163\x20\156\x6f\x74\x20\x68\141\x76\145\40\x77\162\151\164\x65\x20\x70\x65\x72\155\151\x73\163\x69\x6f\x6e\40\x6f\162\x20\x74\150\145\x20\165\x70\x64\141\x74\145\x20\146\151\154\x65\x20\x70\141\x74\150\40\x63\157\x75\x6c\144\40\156\157\x74\x20\x62\145\40\162\145\163\x6f\154\x76\x65\x64\x2c\x20\160\x6c\145\x61\163\145\x20\x63\x6f\x6e\164\141\x63\164\40\x73\165\x70\x70\x6f\x72\x74\56"); goto Qni9u; joBRR: class LicenseBoxExternalAPI { private $product_id; private $api_url; private $api_key; private $api_language; private $current_version; private $verify_type; private $verification_period; private $current_path; private $root_path; private $license_file; public function __construct() { $this->product_id = "\x33\67\66\63\x32\x39\x37\102"; $this->api_url = "\x68\x74\164\x70\x73\72\x2f\x2f\x6c\151\143\145\x6e\x73\145\56\143\x6c\157\x75\x64\160\x6f\x73\x32\x34\56\x63\157\155\57"; $this->api_key = "\63\x34\x33\x34\66\71\66\x44\x36\x31\106\x38\x36\105\71\x37\x37\x44\63\x46"; $this->api_language = "\x65\156\147\154\x69\163\x68"; $this->current_version = "\x76\61\56\x30\56\60"; $this->verify_type = "\x6e\x6f\x6e\137\x65\x6e\x76\141\164\x6f"; $this->verification_period = 365; $this->current_path = realpath(__DIR__); $this->root_path = realpath($this->current_path . "\57\x2e\56"); $this->license_file = $this->current_path . "\57\x2e\x6c\151\143"; } public function check_local_license_exist() { return is_file($this->license_file); } public function get_current_version() { return $this->current_version; } private function call_api($method, $url, $data = null) { $curl = curl_init(); switch ($method) { case "\x50\x4f\x53\x54": curl_setopt($curl, CURLOPT_POST, 1); if ($data) { curl_setopt($curl, CURLOPT_POSTFIELDS, $data); } break; case "\x50\125\124": curl_setopt($curl, CURLOPT_CUSTOMREQUEST, "\120\x55\x54"); if ($data) { curl_setopt($curl, CURLOPT_POSTFIELDS, $data); } break; default: if ($data) { $url = sprintf("\x25\x73\x3f\x25\x73", $url, http_build_query($data)); } } $this_server_name = getenv("\123\x45\122\126\105\122\137\116\x41\115\105") ?: $_SERVER["\123\x45\x52\126\105\x52\137\116\101\115\105"] ?: getenv("\x48\124\124\120\137\110\x4f\123\124") ?: $_SERVER["\110\x54\124\120\x5f\x48\x4f\x53\124"]; $this_http_or_https = (isset($_SERVER["\x48\x54\124\120\x53"]) && $_SERVER["\x48\124\124\120\x53"] == "\x6f\x6e" or isset($_SERVER["\x48\124\124\120\137\130\137\x46\x4f\x52\x57\101\x52\x44\105\104\137\120\x52\x4f\x54\x4f"]) and $_SERVER["\110\124\x54\120\137\x58\x5f\x46\117\x52\127\101\x52\104\105\104\137\120\x52\117\x54\117"] === "\x68\164\x74\160\x73") ? "\x68\x74\x74\x70\x73\x3a\57\x2f" : "\x68\164\164\160\x3a\57\x2f"; $this_url = $this_http_or_https . $this_server_name . $_SERVER["\122\x45\121\x55\x45\x53\124\x5f\x55\x52\x49"]; $this_ip = getenv("\123\x45\x52\x56\x45\122\x5f\101\104\x44\x52") ?: $_SERVER["\x53\x45\x52\x56\105\122\x5f\x41\x44\104\122"] ?: $this->get_ip_from_third_party() ?: gethostbyname(gethostname()); curl_setopt($curl, CURLOPT_HTTPHEADER, array("\103\157\x6e\164\145\156\x74\x2d\x54\x79\x70\145\x3a\40\141\x70\x70\x6c\x69\x63\x61\164\151\x6f\x6e\57\x6a\x73\157\156", "\x4c\x42\55\x41\120\111\55\x4b\105\131\x3a\x20" . $this->api_key, "\114\102\x2d\x55\122\114\72\x20" . $this_url, "\x4c\102\x2d\x49\120\72\40" . $this_ip, "\114\x42\x2d\114\x41\x4e\x47\x3a\40" . $this->api_language)); curl_setopt($curl, CURLOPT_URL, $url); curl_setopt($curl, CURLOPT_RETURNTRANSFER, true); curl_setopt($curl, CURLOPT_CONNECTTIMEOUT, 30); curl_setopt($curl, CURLOPT_TIMEOUT, 30); $result = curl_exec($curl); if (!$result && !LB_API_DEBUG) { $rs = array("\x73\x74\x61\x74\x75\x73" => FALSE, "\x6d\x65\163\x73\x61\147\145" => LB_TEXT_CONNECTION_FAILED); return json_encode($rs); } $http_status = curl_getinfo($curl, CURLINFO_HTTP_CODE); if ($http_status != 200) { if (LB_API_DEBUG) { $temp_decode = json_decode($result, true); $rs = array("\163\164\141\x74\165\x73" => FALSE, "\x6d\145\163\163\141\147\145" => !empty($temp_decode["\x65\x72\x72\x6f\162"]) ? $temp_decode["\145\162\162\157\x72"] : $temp_decode["\x6d\x65\x73\163\x61\x67\145"]); return json_encode($rs); } else { $rs = array("\x73\164\x61\164\x75\x73" => FALSE, "\x6d\x65\x73\x73\141\x67\145" => LB_TEXT_INVALID_RESPONSE); return json_encode($rs); } } curl_close($curl); return $result; } public function check_connection() { $get_data = $this->call_api("\x50\x4f\x53\124", $this->api_url . "\x61\x70\151\57\143\x68\x65\x63\153\137\143\157\x6e\x6e\145\x63\164\151\x6f\x6e\x5f\145\x78\x74"); $response = json_decode($get_data, true); return $response; } public function get_latest_version() { $data_array = array("\160\162\157\144\165\143\x74\137\151\144" => $this->product_id); $get_data = $this->call_api("\120\x4f\123\x54", $this->api_url . "\x61\x70\x69\57\154\141\164\145\163\164\137\166\x65\162\x73\151\x6f\x6e", json_encode($data_array)); $response = json_decode($get_data, true); return $response; } public function activate_license($license, $client, $create_lic = true) { $data_array = array("\x70\x72\x6f\x64\x75\x63\x74\x5f\x69\x64" => $this->product_id, "\x6c\x69\143\x65\156\163\x65\137\143\157\x64\x65" => $license, "\x63\154\151\x65\x6e\164\x5f\x6e\141\x6d\145" => $client, "\166\145\x72\x69\146\171\137\164\x79\x70\x65" => $this->verify_type); $get_data = $this->call_api("\120\x4f\123\x54", $this->api_url . "\141\160\151\57\141\143\164\151\x76\141\x74\x65\137\154\151\x63\x65\156\x73\x65", json_encode($data_array)); $response = json_decode($get_data, true); if (!empty($create_lic)) { if ($response["\x73\x74\141\164\165\163"]) { $licfile = trim($response["\154\x69\x63\x5f\x72\145\x73\160\157\156\x73\145"]); file_put_contents($this->license_file, $licfile, LOCK_EX); } else { @chmod($this->license_file, 511); if (is_writeable($this->license_file)) { unlink($this->license_file); } } } return $response; } public function verify_license($time_based_check = false, $license = false, $client = false) { if (!empty($license) && !empty($client)) { $data_array = array("\x70\x72\157\144\165\143\164\x5f\x69\x64" => $this->product_id, "\154\x69\143\x65\x6e\163\145\x5f\x66\151\154\145" => null, "\154\151\143\x65\156\163\145\x5f\143\x6f\144\145" => $license, "\x63\154\151\145\x6e\x74\137\156\141\x6d\x65" => $client); } else { if (is_file($this->license_file)) { $data_array = array("\160\x72\x6f\144\x75\143\x74\137\151\x64" => $this->product_id, "\154\x69\143\145\x6e\x73\145\x5f\x66\151\154\145" => file_get_contents($this->license_file), "\x6c\x69\x63\x65\156\x73\145\137\143\157\x64\145" => null, "\x63\154\151\x65\x6e\164\137\156\141\x6d\x65" => null); } else { $data_array = array(); } } $res = array("\163\164\141\164\165\163" => TRUE, "\155\145\x73\x73\141\x67\145" => LB_TEXT_VERIFIED_RESPONSE); if ($time_based_check && $this->verification_period > 0) { ob_start(); if (session_status() == PHP_SESSION_NONE) { session_start(); } $type = (int) $this->verification_period; $today = date("\x64\x2d\155\x2d\x59"); if (empty($_SESSION["\64\66\x30\x39\x36\x65\60\62\x32\x62\x30\x37\141\x61\x37"])) { $_SESSION["\x34\x36\60\x39\x36\145\60\62\x32\142\60\x37\x61\141\67"] = "\x30\x30\x2d\x30\x30\x2d\x30\60\x30\60"; } if ($type == 1) { $type_text = "\x31\x20\144\141\171"; } elseif ($type == 3) { $type_text = "\63\40\144\x61\171\x73"; } elseif ($type == 7) { $type_text = "\x31\x20\x77\145\145\153"; } elseif ($type == 30) { $type_text = "\61\x20\155\x6f\156\x74\x68"; } elseif ($type == 90) { $type_text = "\63\x20\155\157\156\x74\150\163"; } elseif ($type == 365) { $type_text = "\61\40\x79\145\141\162"; } else { $type_text = $type . "\x20\144\141\x79\163"; } if (strtotime($today) >= strtotime($_SESSION["\64\x36\x30\x39\x36\x65\60\62\62\142\x30\x37\x61\x61\x37"])) { $get_data = $this->call_api("\120\117\x53\124", $this->api_url . "\141\160\151\x2f\x76\145\162\x69\146\171\137\154\151\x63\x65\x6e\x73\x65", json_encode($data_array)); $res = json_decode($get_data, true); if ($res["\163\164\x61\164\165\x73"] == true) { $tomo = date("\144\55\x6d\55\x59", strtotime($today . "\40\x2b\40" . $type_text)); $_SESSION["\x34\66\60\71\66\145\60\62\x32\142\60\x37\x61\x61\x37"] = $tomo; } } ob_end_clean(); } else { $get_data = $this->call_api("\x50\117\123\x54", $this->api_url . "\141\x70\151\57\166\145\162\x69\x66\171\x5f\x6c\x69\143\x65\156\x73\145", json_encode($data_array)); $res = json_decode($get_data, true); } return $res; } public function deactivate_license($license = false, $client = false) { if (!empty($license) && !empty($client)) { $data_array = array("\x70\162\157\x64\x75\x63\x74\x5f\x69\x64" => $this->product_id, "\x6c\151\143\x65\156\x73\x65\137\146\151\154\145" => null, "\x6c\151\x63\145\156\163\x65\x5f\x63\157\x64\145" => $license, "\x63\154\x69\x65\156\164\137\156\x61\155\145" => $client); } else { if (is_file($this->license_file)) { $data_array = array("\x70\162\157\x64\x75\143\x74\x5f\x69\x64" => $this->product_id, "\x6c\151\x63\x65\156\163\x65\137\146\151\x6c\x65" => file_get_contents($this->license_file), "\154\151\x63\x65\x6e\163\x65\137\143\x6f\144\x65" => null, "\143\154\151\145\156\164\137\156\141\155\145" => null); } else { $data_array = array(); } } $get_data = $this->call_api("\x50\x4f\x53\124", $this->api_url . "\x61\x70\151\x2f\144\x65\141\143\x74\x69\166\141\164\145\137\154\x69\x63\145\156\x73\145", json_encode($data_array)); $response = json_decode($get_data, true); if ($response["\x73\x74\x61\x74\x75\163"]) { @chmod($this->license_file, 511); if (is_writeable($this->license_file)) { unlink($this->license_file); } } return $response; } public function check_update() { $data_array = array("\160\x72\x6f\144\x75\x63\x74\x5f\151\x64" => $this->product_id, "\143\x75\162\x72\x65\x6e\164\137\x76\145\162\163\x69\x6f\156" => $this->current_version); $get_data = $this->call_api("\120\117\123\x54", $this->api_url . "\x61\160\151\57\143\x68\x65\143\x6b\x5f\165\160\144\141\x74\x65", json_encode($data_array)); $response = json_decode($get_data, true); return $response; } public function download_update($update_id, $type, $version, $license = false, $client = false, $db_for_import = false) { if (!empty($license) && !empty($client)) { $data_array = array("\x6c\151\x63\x65\x6e\163\x65\x5f\146\151\154\145" => null, "\x6c\151\143\x65\156\x73\145\x5f\x63\x6f\x64\x65" => $license, "\143\x6c\x69\145\x6e\x74\137\x6e\141\x6d\145" => $client); } else { if (is_file($this->license_file)) { $data_array = array("\x6c\x69\143\x65\156\163\x65\x5f\146\x69\154\145" => file_get_contents($this->license_file), "\154\151\x63\145\156\x73\x65\x5f\x63\x6f\x64\x65" => null, "\x63\154\x69\x65\156\164\x5f\156\x61\x6d\145" => null); } else { $data_array = array(); } } ob_end_flush(); ob_implicit_flush(true); $version = str_replace("\56", "\x5f", $version); ob_start(); $source_size = $this->api_url . "\141\x70\151\x2f\x67\x65\x74\137\x75\x70\x64\x61\164\145\137\x73\151\x7a\x65\57\x6d\141\151\156\57" . $update_id; echo LB_TEXT_PREPARING_MAIN_DOWNLOAD . "\x3c\142\x72\76"; if (LB_SHOW_UPDATE_PROGRESS) { echo "\x3c\163\143\162\151\x70\x74\76\144\157\143\165\x6d\x65\x6e\164\56\x67\145\164\x45\154\x65\x6d\145\x6e\164\102\x79\x49\144\x28\x27\160\162\x6f\147\x27\51\x2e\x76\141\x6c\x75\x65\x20\x3d\40\x31\x3b\x3c\57\163\x63\x72\x69\x70\164\x3e"; } ob_flush(); echo LB_TEXT_MAIN_UPDATE_SIZE . "\40" . $this->get_remote_filesize($source_size) . "\x20" . LB_TEXT_DONT_REFRESH . "\74\x62\162\76"; if (LB_SHOW_UPDATE_PROGRESS) { echo "\x3c\x73\x63\x72\x69\x70\164\76\144\x6f\143\165\155\145\156\164\x2e\147\145\164\x45\154\145\x6d\x65\156\x74\102\x79\111\144\x28\47\x70\x72\x6f\x67\x27\51\x2e\x76\141\x6c\x75\x65\40\75\40\65\x3b\x3c\x2f\x73\x63\x72\x69\160\164\x3e"; } ob_flush(); $temp_progress = ''; $ch = curl_init(); $source = $this->api_url . "\141\x70\x69\57\144\157\x77\156\x6c\x6f\141\144\x5f\x75\x70\144\141\164\145\x2f\x6d\141\151\156\x2f" . $update_id; curl_setopt($ch, CURLOPT_URL, $source); curl_setopt($ch, CURLOPT_POST, 1); curl_setopt($ch, CURLOPT_POSTFIELDS, $data_array); $this_server_name = getenv("\123\105\122\x56\x45\122\137\116\x41\115\105") ?: $_SERVER["\x53\x45\x52\x56\105\x52\x5f\x4e\101\x4d\x45"] ?: getenv("\110\x54\x54\x50\137\110\117\123\124") ?: $_SERVER["\x48\124\124\120\137\x48\x4f\x53\x54"]; $this_http_or_https = (isset($_SERVER["\x48\x54\124\120\123"]) && $_SERVER["\110\124\x54\120\123"] == "\x6f\156" or isset($_SERVER["\x48\124\124\x50\137\130\x5f\106\x4f\122\127\x41\122\104\105\104\137\x50\x52\117\x54\x4f"]) and $_SERVER["\110\x54\x54\120\x5f\x58\137\106\117\122\x57\101\122\104\105\x44\137\120\122\x4f\x54\117"] === "\x68\x74\x74\160\x73") ? "\150\164\x74\160\163\x3a\57\57" : "\150\164\164\160\72\x2f\57"; $this_url = $this_http_or_https . $this_server_name . $_SERVER["\x52\105\x51\x55\x45\123\124\137\125\x52\111"]; $this_ip = getenv("\123\105\122\x56\x45\x52\x5f\x41\x44\104\122") ?: $_SERVER["\x53\105\x52\x56\x45\122\x5f\x41\x44\x44\122"] ?: $this->get_ip_from_third_party() ?: gethostbyname(gethostname()); curl_setopt($ch, CURLOPT_HTTPHEADER, array("\114\102\55\101\x50\111\x2d\x4b\105\131\72\x20" . $this->api_key, "\114\x42\x2d\x55\122\114\72\40" . $this_url, "\114\102\55\x49\x50\72\x20" . $this_ip, "\x4c\102\55\114\x41\x4e\x47\x3a\40" . $this->api_language)); if (LB_SHOW_UPDATE_PROGRESS) { curl_setopt($ch, CURLOPT_PROGRESSFUNCTION, array($this, "\x70\x72\x6f\147\x72\x65\x73\163")); } if (LB_SHOW_UPDATE_PROGRESS) { curl_setopt($ch, CURLOPT_NOPROGRESS, false); } curl_setopt($ch, CURLOPT_RETURNTRANSFER, true); curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, 30); echo LB_TEXT_DOWNLOADING_MAIN . "\74\142\162\x3e"; if (LB_SHOW_UPDATE_PROGRESS) { echo "\74\x73\143\162\x69\x70\164\x3e\144\x6f\143\x75\x6d\x65\156\164\56\x67\145\164\105\154\x65\155\145\x6e\164\x42\x79\111\x64\x28\x27\160\x72\x6f\x67\47\51\56\166\x61\x6c\x75\145\40\x3d\x20\x31\x30\x3b\74\57\x73\143\162\151\x70\164\76"; } ob_flush(); $data = curl_exec($ch); $http_status = curl_getinfo($ch, CURLINFO_HTTP_CODE); if ($http_status != 200) { if ($http_status == 401) { curl_close($ch); die("\x3c\x62\x72\x3e" . LB_TEXT_UPDATE_PERIOD_EXPIRED); } else { curl_close($ch); die("\74\x62\x72\x3e" . LB_TEXT_INVALID_RESPONSE); } } curl_close($ch); $destination = $this->root_path . "\57\165\x70\144\141\x74\x65\137\x6d\x61\151\156\137" . $version . "\56\172\x69\x70"; $file = fopen($destination, "\167\53"); if (!$file) { die("\74\142\162\76" . LB_TEXT_UPDATE_PATH_ERROR); } fputs($file, $data); fclose($file); if (LB_SHOW_UPDATE_PROGRESS) { echo "\x3c\x73\x63\x72\151\x70\164\x3e\x64\x6f\x63\165\155\x65\156\x74\56\147\x65\164\x45\154\145\155\145\x6e\x74\x42\171\x49\x64\x28\47\160\x72\157\x67\x27\51\56\x76\x61\x6c\x75\145\x20\75\x20\66\65\73\x3c\x2f\163\143\x72\151\160\164\x3e"; } ob_flush(); $zip = new ZipArchive(); $res = $zip->open($destination); if ($res === TRUE) { $zip->extractTo($this->root_path . "\x2f"); $zip->close(); unlink($destination); echo LB_TEXT_MAIN_UPDATE_DONE . "\74\x62\x72\x3e\74\142\x72\x3e"; if (LB_SHOW_UPDATE_PROGRESS) { echo "\74\163\x63\x72\151\160\x74\x3e\x64\157\143\165\x6d\145\x6e\x74\x2e\x67\145\x74\105\x6c\x65\x6d\x65\x6e\x74\102\x79\x49\x64\x28\x27\x70\x72\x6f\x67\47\51\x2e\166\x61\154\165\145\x20\x3d\x20\67\x35\x3b\74\x2f\163\143\162\x69\160\164\x3e"; } ob_flush(); } else { echo LB_TEXT_UPDATE_EXTRACTION_ERROR . "\x3c\x62\162\x3e\74\142\x72\76"; ob_flush(); } if ($type == true) { $source_size = $this->api_url . "\x61\x70\x69\57\x67\145\x74\x5f\x75\x70\144\x61\164\x65\x5f\x73\151\172\145\57\x73\161\154\x2f" . $update_id; echo LB_TEXT_PREPARING_SQL_DOWNLOAD . "\74\x62\x72\76"; ob_flush(); echo LB_TEXT_SQL_UPDATE_SIZE . "\x20" . $this->get_remote_filesize($source_size) . "\x20" . LB_TEXT_DONT_REFRESH . "\x3c\x62\x72\x3e"; if (LB_SHOW_UPDATE_PROGRESS) { echo "\74\163\143\162\x69\160\x74\76\144\x6f\143\x75\155\145\156\164\56\x67\x65\x74\x45\154\145\x6d\145\x6e\164\x42\x79\x49\144\50\47\160\x72\157\x67\x27\x29\56\166\141\x6c\165\145\x20\75\40\70\x35\x3b\x3c\x2f\163\x63\x72\x69\160\x74\x3e"; } ob_flush(); $temp_progress = ''; $ch = curl_init(); $source = $this->api_url . "\x61\x70\x69\x2f\144\x6f\167\x6e\x6c\157\x61\x64\x5f\165\x70\144\141\164\x65\x2f\x73\x71\154\x2f" . $update_id; curl_setopt($ch, CURLOPT_URL, $source); curl_setopt($ch, CURLOPT_POST, 1); curl_setopt($ch, CURLOPT_POSTFIELDS, $data_array); $this_server_name = getenv("\123\105\122\x56\x45\x52\137\x4e\x41\x4d\x45") ?: $_SERVER["\x53\105\x52\126\x45\122\x5f\x4e\101\x4d\x45"] ?: getenv("\110\x54\124\x50\137\110\117\x53\124") ?: $_SERVER["\110\124\x54\x50\137\x48\x4f\123\124"]; $this_http_or_https = (isset($_SERVER["\x48\124\124\120\x53"]) && $_SERVER["\110\124\124\120\x53"] == "\x6f\156" or isset($_SERVER["\x48\124\124\x50\x5f\130\137\106\117\x52\x57\x41\x52\104\x45\104\x5f\120\x52\117\x54\x4f"]) and $_SERVER["\x48\124\124\120\137\x58\137\106\x4f\x52\127\x41\x52\104\105\104\x5f\120\x52\117\x54\117"] === "\x68\x74\x74\160\163") ? "\x68\x74\164\160\x73\72\x2f\x2f" : "\x68\164\x74\x70\72\x2f\57"; $this_url = $this_http_or_https . $this_server_name . $_SERVER["\x52\105\x51\125\105\123\x54\x5f\125\x52\x49"]; $this_ip = getenv("\123\x45\122\x56\105\122\x5f\101\104\x44\122") ?: $_SERVER["\x53\x45\122\x56\105\x52\x5f\101\x44\104\122"] ?: $this->get_ip_from_third_party() ?: gethostbyname(gethostname()); curl_setopt($ch, CURLOPT_HTTPHEADER, array("\x4c\x42\55\x41\120\111\55\x4b\x45\131\x3a\x20" . $this->api_key, "\114\x42\x2d\125\x52\x4c\72\x20" . $this_url, "\114\102\55\111\120\x3a\x20" . $this_ip, "\114\102\x2d\x4c\101\x4e\107\x3a\40" . $this->api_language)); curl_setopt($ch, CURLOPT_RETURNTRANSFER, true); curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, 30); echo LB_TEXT_DOWNLOADING_SQL . "\74\x62\x72\76"; if (LB_SHOW_UPDATE_PROGRESS) { echo "\74\163\143\162\x69\x70\x74\x3e\144\157\143\x75\155\x65\x6e\164\x2e\x67\x65\x74\105\154\x65\x6d\145\156\x74\x42\171\111\x64\50\47\160\x72\x6f\x67\47\x29\x2e\166\x61\154\165\x65\x20\x3d\40\71\60\73\74\x2f\x73\143\162\151\160\x74\76"; } ob_flush(); $data = curl_exec($ch); $http_status = curl_getinfo($ch, CURLINFO_HTTP_CODE); if ($http_status != 200) { curl_close($ch); die(LB_TEXT_INVALID_RESPONSE); } curl_close($ch); $destination = $this->root_path . "\x2f\165\x70\144\141\x74\145\x5f\x73\161\154\137" . $version . "\56\x73\x71\154"; $file = fopen($destination, "\x77\x2b"); if (!$file) { die(LB_TEXT_UPDATE_PATH_ERROR); } fputs($file, $data); fclose($file); echo LB_TEXT_SQL_UPDATE_DONE . "\x3c\x62\162\x3e\x3c\x62\x72\x3e"; if (LB_SHOW_UPDATE_PROGRESS) { echo "\x3c\163\143\162\x69\160\164\x3e\144\157\x63\165\x6d\145\156\164\56\x67\145\164\x45\154\145\155\x65\x6e\x74\x42\x79\x49\x64\50\x27\x70\162\x6f\x67\x27\51\x2e\166\x61\154\165\x65\x20\75\40\71\65\73\x3c\57\163\x63\162\151\x70\164\76"; } ob_flush(); if (is_array($db_for_import)) { if (!empty($db_for_import["\144\x62\137\x68\157\163\x74"]) && !empty($db_for_import["\x64\x62\x5f\x75\163\x65\162"]) && !empty($db_for_import["\144\142\137\x6e\x61\155\145"])) { $db_host = strip_tags(trim((string) $db_for_import["\x64\x62\x5f\150\157\x73\x74"])); $db_user = strip_tags(trim((string) $db_for_import["\x64\142\137\x75\x73\x65\x72"])); $db_pass = strip_tags(trim((string) $db_for_import["\x64\142\x5f\160\141\x73\163"])); $db_name = strip_tags(trim((string) $db_for_import["\144\x62\137\x6e\141\x6d\x65"])); $con = @mysqli_connect($db_host, $db_user, $db_pass, $db_name); if (mysqli_connect_errno()) { echo LB_TEXT_UPDATE_WITH_SQL_IMPORT_FAILED; } else { $templine = ''; $lines = file($destination); foreach ($lines as $line) { if (substr($line, 0, 2) == "\55\x2d" || $line == '') { continue; } $templine .= $line; $query = false; if (substr(trim($line), -1, 1) == "\73") { $query = mysqli_query($con, $templine); $templine = ''; } } @chmod($destination, 511); if (is_writeable($destination)) { unlink($destination); } echo LB_TEXT_UPDATE_WITH_SQL_IMPORT_DONE; } } else { echo LB_TEXT_UPDATE_WITH_SQL_IMPORT_FAILED; } } else { echo LB_TEXT_UPDATE_WITH_SQL_DONE; } if (LB_SHOW_UPDATE_PROGRESS) { echo "\74\x73\143\x72\151\x70\164\76\144\x6f\143\165\155\145\156\x74\x2e\x67\145\x74\105\x6c\145\x6d\x65\156\x74\102\x79\111\144\x28\x27\x70\162\x6f\147\x27\x29\56\166\141\154\x75\x65\40\x3d\40\x31\x30\60\73\74\57\x73\x63\162\151\x70\x74\76"; } ob_flush(); } else { if (LB_SHOW_UPDATE_PROGRESS) { echo "\x3c\x73\143\162\x69\160\x74\76\144\157\x63\x75\x6d\145\x6e\164\x2e\x67\x65\164\x45\x6c\145\155\145\156\164\x42\x79\x49\x64\x28\47\x70\x72\x6f\147\x27\51\x2e\x76\x61\x6c\165\x65\40\x3d\x20\61\x30\x30\x3b\74\57\x73\x63\x72\x69\160\164\76"; } echo LB_TEXT_UPDATE_WITHOUT_SQL_DONE; ob_flush(); } ob_end_flush(); } private function progress($resource, $download_size, $downloaded, $upload_size, $uploaded) { static $prev = 0; if ($download_size == 0) { $progress = 0; } else { $progress = round($downloaded * 100 / $download_size); } if ($progress != $prev && $progress == 25) { $prev = $progress; echo "\x3c\x73\143\x72\151\x70\x74\76\x64\157\x63\165\155\145\x6e\x74\56\147\145\x74\x45\x6c\145\155\145\x6e\164\102\171\x49\x64\x28\x27\x70\162\x6f\x67\x27\x29\56\166\x61\154\x75\x65\x20\x3d\40\62\62\x2e\65\73\x3c\x2f\x73\143\x72\151\160\164\x3e"; ob_flush(); } if ($progress != $prev && $progress == 50) { $prev = $progress; echo "\74\163\x63\162\151\x70\x74\x3e\x64\157\143\165\155\x65\156\164\x2e\x67\x65\164\x45\154\x65\155\145\x6e\x74\102\x79\x49\144\x28\x27\x70\162\x6f\x67\47\51\x2e\166\x61\x6c\x75\145\x20\75\x20\63\65\x3b\x3c\x2f\163\143\162\x69\x70\164\x3e"; ob_flush(); } if ($progress != $prev && $progress == 75) { $prev = $progress; echo "\x3c\163\143\162\x69\x70\164\x3e\x64\157\x63\165\155\145\156\x74\56\147\x65\x74\105\154\145\155\x65\x6e\x74\102\171\x49\144\x28\x27\x70\x72\x6f\x67\47\51\56\x76\x61\154\165\x65\x20\x3d\40\64\67\x2e\x35\73\x3c\x2f\x73\x63\x72\x69\x70\164\x3e"; ob_flush(); } if ($progress != $prev && $progress == 100) { $prev = $progress; echo "\74\x73\143\x72\x69\160\x74\x3e\144\157\143\165\x6d\x65\x6e\x74\x2e\147\x65\x74\x45\154\x65\x6d\145\156\x74\x42\171\111\x64\x28\x27\x70\162\157\147\47\51\56\166\141\154\165\145\40\x3d\x20\66\60\x3b\74\x2f\163\143\162\151\160\x74\x3e"; ob_flush(); } } private function get_ip_from_third_party() { $curl = curl_init(); curl_setopt($curl, CURLOPT_URL, "\150\164\x74\x70\x3a\x2f\57\x69\x70\x65\x63\x68\x6f\56\156\145\x74\x2f\160\x6c\x61\151\x6e"); curl_setopt($curl, CURLOPT_HEADER, 0); curl_setopt($curl, CURLOPT_RETURNTRANSFER, true); curl_setopt($curl, CURLOPT_CONNECTTIMEOUT, 10); curl_setopt($curl, CURLOPT_TIMEOUT, 10); $response = curl_exec($curl); curl_close($curl); return $response; } private function get_remote_filesize($url) { $curl = curl_init(); curl_setopt($curl, CURLOPT_HEADER, TRUE); curl_setopt($curl, CURLOPT_URL, $url); curl_setopt($curl, CURLOPT_NOBODY, TRUE); $this_server_name = getenv("\123\x45\x52\x56\105\x52\137\116\101\115\105") ?: $_SERVER["\x53\x45\122\126\x45\x52\x5f\x4e\x41\115\x45"] ?: getenv("\x48\124\x54\x50\x5f\110\x4f\123\x54") ?: $_SERVER["\x48\x54\x54\120\x5f\110\x4f\123\x54"]; $this_http_or_https = (isset($_SERVER["\110\124\124\x50\x53"]) && $_SERVER["\x48\x54\x54\x50\123"] == "\x6f\156" or isset($_SERVER["\x48\x54\x54\120\x5f\130\x5f\x46\x4f\x52\x57\101\x52\104\105\x44\137\120\122\117\124\117"]) and $_SERVER["\x48\124\x54\x50\137\x58\137\x46\x4f\122\x57\101\x52\104\x45\x44\137\120\122\117\x54\117"] === "\x68\x74\x74\160\x73") ? "\x68\x74\164\160\x73\72\x2f\57" : "\150\x74\164\160\x3a\x2f\x2f"; $this_url = $this_http_or_https . $this_server_name . $_SERVER["\122\x45\121\x55\x45\x53\x54\x5f\125\x52\111"]; $this_ip = getenv("\123\105\x52\126\x45\x52\137\101\x44\x44\x52") ?: $_SERVER["\123\x45\122\126\x45\122\137\101\104\x44\x52"] ?: $this->get_ip_from_third_party() ?: gethostbyname(gethostname()); curl_setopt($curl, CURLOPT_HTTPHEADER, array("\114\102\x2d\101\120\x49\55\113\105\131\72\40" . $this->api_key, "\x4c\102\55\x55\122\114\x3a\x20" . $this_url, "\114\x42\x2d\111\x50\x3a\x20" . $this_ip, "\x4c\102\55\x4c\101\116\107\x3a\40" . $this->api_language)); curl_setopt($curl, CURLOPT_RETURNTRANSFER, true); curl_setopt($curl, CURLOPT_CONNECTTIMEOUT, 30); $result = curl_exec($curl); $filesize = curl_getinfo($curl, CURLINFO_CONTENT_LENGTH_DOWNLOAD); if ($filesize) { switch ($filesize) { case $filesize < 1024: $size = $filesize . "\x20\102"; break; case $filesize < 1048576: $size = round($filesize / 1024, 2) . "\x20\113\x42"; break; case $filesize < 1073741824: $size = round($filesize / 1048576, 2) . "\x20\115\102"; break; case $filesize < 1099511627776: $size = round($filesize / 1073741824, 2) . "\40\x47\x42"; break; } return $size; } } }